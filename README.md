### Simple Keystone Gated Service

Thereâ€™s a simple service written to test all of this. It can be cloned:

````shell
$ git clone http://github.com/dizz/
````

Once cloned you can issue `docker-compose up`.

This will run all the required keystone services and the example application. You will need a keystone token to access the service. Do this by setting these environment varia  bles and issuing a `curl` command:

```shell
$ export OS_PROJECT_DOMAIN_NAME=Default
$ export OS_USER_DOMAIN_NAME=Default
$ export OS_PROJECT_NAME=admin
$ export OS_USERNAME=admin
$ export OS_PASSWORD=admin
$ export OS_AUTH_URL=http://keystone:35357/v3
$ export OS_IDENTITY_API_VERSION=3$ 
```

Note that the credentials can be customised by editing the `docker-compose.yml` file. Issue this `curl` command to get a Keystone token:

```shell
$ curl -si -X POST $OS_AUTH_URL/auth/tokens\?nocatalog -H "Content-Type: application/json" -d '{ "auth": { "identity": { "methods": ["password"],"password": {"user": {"domain": {"name": "'"$OS_USER_DOMAIN_NAME"'"},"name": "'"$OS_USERNAME"'", "password": "'"$OS_PASSWORD"'"} } }, "scope": { "project": { "domain": { "name": "'"$OS_PROJECT_DOMAIN_NAME"'" }, "name":  "'"$OS_PROJECT_NAME"'" } } }}'
```

The response will contain your token in the header `X-Subject-Token`. Once you have this value set it against the `X-Auth-Token` header in the following `curl` request:

```shell
$ curl -v -H 'X-Auth-Token: YOUR_KEYSTONE_TOKEN' localhost:56567/health
```

The result will be a simple JSON document generated by the service. If you do not want to use keystone then set the environment variable `ET_AAA_ESM_KEYSTONE_AUTH_URL` defined in the `docker-compose.yml` to empty.
